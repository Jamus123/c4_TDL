<!DOCTYPE html>
<html>
<head>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link rel='stylesheet' href='todo_styles.css'>
	

	<title>To Do List</title>
	<script>
		

		function getServerList(){
			console.log('in getServerList');
			$.ajax({
					
					url: '../assets/get_todo_items.js',
					dataType:'json',
					crossDomain: true,
					cache: false,
					success: function(response){

						console.log('response: '+response);
						window.todo_objects = response;
						generateList(todo_objects);
						 $('.task_list_container').on('click', '.task_entry', function(){
							console.log('in reveal task handler')
							console.log('this: '+ $(this));

						var current_index = $(this).attr('index_id');
						var target_id = '#task_details'+current_index;

						console.log('this: ' + $(this).attr('index_id'));
						$(target_id).toggleClass('shown_task_details');
						
	

					})

			}

		})
}	

		function deleteTask(){
				console.log('in deleteTask')
			$('.task_list_container').on('click', '.delete_task', function(){
				console.log('id of this: ',$(this));
				
			var current_index = $(this).attr('index_id');
						var target_id = '#task'+current_index;

						console.log('this: ' + $(this).attr('index_id'));
						$(target_id).remove();
						delete todo_objects[current_index];	
					})	
		}

		function taskComplete(){
				$('.task_list_container').on('click', '.completed_task', function(){
				console.log('id of this: ',$(this));
				
						var current_index = $(this).attr('index_id');
						var target_id = '#task'+current_index;


						console.log('this: ' + $(this).attr('index_id'));
						$(target_id).addClass('task_details')
						$('.task_completed_container').append($(target_id));
						 	
					})	
		}

		function showCompleted(){
			console.log('in showCompleted');
			$('.task_completed_container').click(function(){
				$('.task_list').toggleClass('shown_task_details');
			})
		}

		function generateList(todo_object_arr){
			
			console.log('in generateList')
		for (var i=0; i<todo_object_arr.length; i++){
			console.log('in for loop');
			var task_list_entry = $('<div>',{
										class: 'task_list col-xs-12',
										id: 'task'+todo_object_arr[i].id,
			});
			var task_title = $('<li>',{
								text: todo_object_arr[i].title,
								class: 'task_entry col-xs-6',
								index_id: todo_object_arr[i].id,
			});
			var edit_button = $('<button>',{
								text: 'Edit',
								type: 'button',
								class: 'col-xs-1 col-sm-offset-1 edit_task',

			});
			var delete_button = $('<button>',{
								text: 'Delete',
								type: 'button',
								class: 'col-xs-1 col-sm-offset-1 delete_task',
								id: 'delete'+todo_object_arr[i].id,
								index_id: 	todo_object_arr[i].id,

			});
			var task_complete = $('<button>',{
								text:'Completed',
								type: 'button',
								class: 'col-xs-1 col-sm-offset-1 completed_task',
								id: 'complete'+todo_object_arr[i].id,
								index_id: 	todo_object_arr[i].id,

			});
			
							
			var details_div = $('<div>',{
								id: 'task_details'+todo_object_arr[i].id,
								class:'task_details col-xs-12',
			});

			var details_span = $('<span>',{
								text: todo_object_arr[i].details,
								class: 'col-xs-6',

			});

			var initial_time = $('<span>',{
								text:'Made: ' + todo_object_arr[i].timeStamp,
								class: 'col-xs-2 col-xs-offset-1',
			});

			var due_time = $('<span>',{
								text: 'Due: time_due',
								class: 'col-xs-2 col-xs-offset-1',
			});					


							details_div.append(details_span, initial_time, due_time);
							
						
			task_list_entry.append(task_title, edit_button, delete_button, task_complete);
			task_list_entry.append(details_div);
						$('.task_list_container').append(task_list_entry);

			
			}
		}
	

$(document).ready(function(){
	getServerList();
	taskComplete();
	deleteTask();
	showCompleted();
	


});


	</script>

</head>
<body>
	<div class='col-xs-12 container task_list_container'>
	<header class='col-xs-12'>
		<h1 class='col-xs-3 col-xs-offset-5'>Current Tasks</h1>
		
	</header>
	
		
			
		

		
	</div>

	<div class='col-xs-12 container task_completed_container'>
	
		<h4 class='col-xs-3 '>Completed Tasks</h4>
		<div id='completed_contents' class='col-xs-12'></div>
	
	
		
			
		

		
	</div>
</body>
</html>